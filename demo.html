<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KoftaGard ‚Äî –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –•—É–¥–∂–∞–Ω–¥–∞</title>

  <style>
    :root{
      --bg: #f3fbf6;
      --card: #ffffff;
      --border: rgba(16, 24, 40, .10);
      --text: #0f172a;
      --muted: rgba(15, 23, 42, .70);
      --muted2: rgba(15, 23, 42, .55);
      --accent: #4CAF50;   /* –≤–∞—à —Ü–≤–µ—Ç */
      --accent2:#3f9f44;   /* —á—É—Ç—å —Ç–µ–º–Ω–µ–µ */
      --shadow: 0 18px 50px rgba(2, 44, 18, .10);
      --radius: 18px;
    }
    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 500px at 20% -10%, rgba(76,175,80,.18), transparent 60%),
        radial-gradient(900px 500px at 80% 0%, rgba(76,175,80,.10), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height:100vh;
    }
    .wrap{ max-width: 1120px; margin:0 auto; padding: 20px 16px 48px; }
    a{ color: inherit; text-decoration:none; }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding: 8px 0 18px;
    }
    .brand{ display:flex; align-items:center; gap:12px; font-weight: 800; }
    .logo{
      width: 42px; height: 42px; border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, .12);
      background: #fff;
      overflow:hidden;
      box-shadow: 0 10px 30px rgba(76,175,80,.14);
      display:grid; place-items:center;
      flex: 0 0 auto;
    }
    .logo img{
      width: 100%; height: 100%;
      object-fit: cover;
      display:block;
    }
    .brand small{ display:block; color: var(--muted2); font-weight: 650; margin-top:2px; }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.86);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 750;
      transition: transform .08s ease, box-shadow .15s ease, border-color .15s ease;
      user-select:none;
      cursor:pointer;
    }
    .btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(2,44,18,.08);
      border-color: rgba(76,175,80,.35);
    }

    .hero{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.86);
      border-radius: calc(var(--radius) + 6px);
      padding: 22px;
      box-shadow: var(--shadow);
    }
    .hero-inner{ display:grid; grid-template-columns: 1fr; gap:16px; }
    .hero h1{
      margin:0 0 8px;
      font-size: clamp(24px, 3.2vw, 38px);
      line-height: 1.15;
      letter-spacing: -.4px;
    }
    .hero p{ margin:0 0 14px; color: var(--muted); font-size: 15.5px; line-height: 1.55; max-width: 68ch; }

    .searchpanel{
      border: 1px solid rgba(76,175,80,.22);
      background: rgba(243,251,246,.78);
      border-radius: 18px;
      padding: 14px;
      display:grid;
      gap:10px;
    }
    .fieldrow{ display:grid; grid-template-columns: 1fr 220px 180px; gap:10px; }
    @media (max-width: 880px){ .fieldrow{ grid-template-columns: 1fr; } }

    input, select{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, .12);
      background: #fff;
      color: var(--text);
      outline:none;
      font-size: 15px;
    }
    input:focus, select:focus{
      border-color: rgba(76,175,80,.75);
      box-shadow: 0 0 0 4px rgba(76,175,80,.14);
    }
    .hint{
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      color: var(--muted2); font-size: 13px;
    }

    .section{ margin-top: 22px; }
    .section h2{ margin:0 0 10px; font-size: 18px; }
    .sub{ margin: -6px 0 12px; color: var(--muted2); font-size: 13.5px; }

    .cats{ display:grid; grid-template-columns: repeat(7, 1fr); gap:10px; }
    @media (max-width: 980px){ .cats{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 520px){ .cats{ grid-template-columns: repeat(2, 1fr); } }

    .cat{
      border: 1px solid rgba(15, 23, 42, .12);
      background: #fff;
      border-radius: 16px;
      padding: 12px 12px;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .15s ease, border-color .15s ease;
      min-height: 54px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .cat:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(2,44,18,.08);
      border-color: rgba(76,175,80,.35);
    }
    .cat.active{
      border-color: rgba(76,175,80,.70);
      background: rgba(76,175,80,.10);
    }
    .badge{
      width: 34px; height: 34px; border-radius: 12px;
      background: rgba(76,175,80,.10);
      display:grid; place-items:center;
      border: 1px solid rgba(76,175,80,.20);
      font-size: 16px;
    }
    .cat .title{ font-weight: 800; }
    .count{ color: var(--muted2); font-size: 12.5px; }

    .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    @media (max-width: 980px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 580px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      border: 1px solid rgba(15, 23, 42, .12);
      background: #fff;
      border-radius: var(--radius);
      overflow:hidden;
      transition: transform .08s ease, box-shadow .15s ease, border-color .15s ease;
    }

    .card a { color: inherit; }
    .card a:focus { outline: none; }
    .card a:focus-visible {
      box-shadow: 0 0 0 4px rgba(76,175,80,.18);
      border-radius: var(--radius);
    }

    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 45px rgba(2,44,18,.10);
      border-color: rgba(76,175,80,.35);
    }
    .thumb{ aspect-ratio: 16/9; background: rgba(15, 23, 42, .04); position:relative; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .thumb .pill{
      position:absolute; left:12px; top:12px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 800;
      background: rgba(255,255,255,.90);
      border: 1px solid rgba(15, 23, 42, .12);
      backdrop-filter: blur(8px);
    }
    .content{ padding: 12px 12px 14px; }
    .name{ margin:0 0 6px; font-weight: 850; font-size: 16px; }
    .meta{ margin:0 0 10px; color: var(--muted); font-size: 13.5px; line-height: 1.45; }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-bottom: 10px; color: var(--muted2); font-size: 13px; }
    .stars{ font-weight: 800; }

    .card .btns{ display:flex; gap:8px; flex-wrap:wrap; }
    .card .btns a{
      padding: 9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(15, 23, 42, .12);
      background: rgba(243,251,246,.85);
      font-weight: 800;
      font-size: 13px;
    }
    .card .btns a:hover{
      border-color: rgba(76,175,80,.40);
      background: rgba(76,175,80,.10);
    }

    .empty{
      border: 1px dashed rgba(15, 23, 42, .18);
      border-radius: var(--radius);
      padding: 16px;
      color: var(--muted);
      background: rgba(255,255,255,.75);
    }

    footer{
      margin-top: 26px;
      color: var(--muted2);
      font-size: 12.5px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" title="KoftaGard">
          <img
            src="https://play-lh.googleusercontent.com/hz0iJ1uOy2Qla1j20KA0fOg5yMwvuD2atqnD2OYVsHeYPmoL99J399NdZGlFgmhXcpKvlVrQd_CMQd5Yo13N=w240-h480-rw"
            alt="KoftaGard Logo"
            loading="lazy"
          />
        </div>
        <div>
          KoftaGard
          <small>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –•—É–¥–∂–∞–Ω–¥–∞</small>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnLocate" type="button">üìç –†—è–¥–æ–º —Å–æ –º–Ω–æ–π</button>
      </div>
    </div>

    <section class="hero">
      <div class="hero-inner">
        <div>
          <h1>–ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –•—É–¥–∂–∞–Ω–¥–µ ‚Äî –±—ã—Å—Ç—Ä–æ</h1>
          <p>–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Ä—è–¥–æ–º —Å –≤–∞–º–∏: –µ–¥–∞, —Å–∞–ª–æ–Ω—ã, –∞–ø—Ç–µ–∫–∏, –º–∞–≥–∞–∑–∏–Ω—ã, —Ä–µ–º–æ–Ω—Ç –∏ —É—Å–ª—É–≥–∏.</p>

          <div class="searchpanel">
            <div class="fieldrow">
              <input id="q" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–æ—Ñ–µ, –∞–ø—Ç–µ–∫–∞, —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂‚Ä¶" />
              <select id="catSelect">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
              </select>
              <select id="sort">
                <option value="popular">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                <option value="rating">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Ä–µ–π—Ç–∏–Ω–≥</option>
                <option value="near">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Ä—è–¥–æ–º</option>
              </select>
            </div>
            <div class="hint">
              <span id="status">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</span>
              <span id="geoStatus">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
      <div class="sub">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±–Ω–æ–≤—è—Ç—Å—è.</div>
      <div class="cats" id="cats"></div>
    </section>

    <section class="section">
      <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
      <div class="sub">–§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∏—Å–∫—É/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É –∏–ª–∏ ‚Äú—Ä—è–¥–æ–º‚Äù.</div>
      <div class="grid" id="results"></div>
      <div id="empty" class="empty" style="display:none; margin-top:12px;">
        –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.
      </div>
    </section>

    <section class="section">
      <h2>–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ –≤ –•—É–¥–∂–∞–Ω–¥–µ</h2>
      <div class="sub">–ü–æ–¥–±–æ—Ä–∫–∞ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É.</div>
      <div class="grid" id="popular"></div>
    </section>

    <section class="section">
      <h2>–†—è–¥–æ–º —Å–æ –º–Ω–æ–π</h2>
      <div class="sub">–ù–∞–∂–º–∏—Ç–µ ‚Äú–†—è–¥–æ–º —Å–æ –º–Ω–æ–π‚Äù, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –±–ª–∏–∂–∞–π—à–∏–µ –º–µ—Å—Ç–∞.</div>
      <div class="grid" id="near"></div>
      <div id="nearHint" class="empty" style="display:none; margin-top:12px;">
        –ù–∞–∂–º–∏—Ç–µ ‚Äúüìç –†—è–¥–æ–º —Å–æ –º–Ω–æ–π‚Äù –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.
      </div>
    </section>

    <footer>
      <div>KoftaGard ‚Ä¢ Khujand</div>
      <div>¬© 2026</div>
    </footer>
  </div>

  <script>
    const CATEGORIES_URL = "./categories.json";
    const PLACES_URL = "./places.json";

    const state = {
      categories: [],
      places: [],
      selectedCategory: "",
      query: "",
      sort: "popular",
      userPos: null
    };

    const $ = (id) => document.getElementById(id);

    function esc(s){
      return String(s ?? "").replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function kmFromTo(lat1, lon1, lat2, lon2){
      const R = 6371;
      const toRad = (d) => d * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2)**2 +
                Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*
                Math.sin(dLon/2)**2;
      return 2 * R * Math.asin(Math.sqrt(a));
    }

    function normalizePlace(p){
      return {
        id: String(p.id ?? crypto.randomUUID()),
        name: p.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",
        category: p.category || "",
        city: p.city || "Khujand",
        address: p.address || "",
        geo: {
          lat: Number(p.geo?.lat ?? p.lat ?? NaN),
          lng: Number(p.geo?.lng ?? p.lng ?? NaN)
        },
        cover: p.cover || "",
        contacts: {
          phone: p.contacts?.phone || p.phone || "",
          website: p.contacts?.website || ""
        },
        tags: Array.isArray(p.tags) ? p.tags : [],
        rating: Number.isFinite(+p.rating) ? +p.rating : null,
        price_level: Number.isFinite(+p.price_level) ? +p.price_level : null
      };
    }

    function getCategoryTitle(catId){
      const c = state.categories.find(x => x.id === catId);
      return c ? c.title : catId;
    }

    function placeHasQuery(p, q){
      if(!q) return true;
      const hay = (p.name + " " + (p.address||"") + " " + (p.tags||[]).join(" ")).toLowerCase();
      return hay.includes(q.toLowerCase());
    }

    function cardHTML(p){
      const catTitle = getCategoryTitle(p.category);
      const phone = p.contacts.phone;
      const hasGeo = Number.isFinite(p.geo.lat) && Number.isFinite(p.geo.lng);
    
      const dist = (state.userPos && hasGeo)
        ? kmFromTo(state.userPos.lat, state.userPos.lng, p.geo.lat, p.geo.lng)
        : null;
    
      const pill = dist != null ? `${catTitle} ‚Ä¢ ${dist.toFixed(1)} –∫–º` : catTitle;
      const rating = (p.rating != null) ? `‚≠ê ${p.rating.toFixed(1)}` : "‚Äî";
      const price = (p.price_level != null) ? "‚Ç∏".repeat(Math.max(1, Math.min(4, p.price_level))) : "";
    
      const img = p.cover
        ? `<img src="${esc(p.cover)}" alt="${esc(p.name)}" loading="lazy">`
        : `<div style="width:100%;height:100%;display:grid;place-items:center;color:rgba(15,23,42,.55)">–ù–µ—Ç —Ñ–æ—Ç–æ</div>`;
    
      const mapsLink = hasGeo ? `https://www.google.com/maps?q=${p.geo.lat},${p.geo.lng}` : "";
      const detailsLink = `./place.html?id=${encodeURIComponent(p.id)}`;
    
      return `
        <article class="card" role="article">
          <a href="${detailsLink}" style="display:block">
            <div class="thumb">
              ${img}
              <div class="pill">${esc(pill)}</div>
            </div>
            <div class="content">
              <h3 class="name">${esc(p.name)}</h3>
              <p class="meta">${esc(p.address || "–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω")}</p>
              <div class="row">
                <div class="stars">${rating}</div>
                <div>${price}</div>
              </div>
            </div>
          </a>
    
          <div class="content" style="padding-top:0">
            <div class="btns">
              ${phone ? `<a href="tel:${esc(phone)}" onclick="event.stopPropagation()">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>` : ""}
              ${mapsLink ? `<a target="_blank" rel="noopener" href="${esc(mapsLink)}" onclick="event.stopPropagation()">üß≠ –ú–∞—Ä—à—Ä—É—Ç</a>` : ""}
              ${p.contacts.website ? `<a target="_blank" rel="noopener" href="${esc(p.contacts.website)}" onclick="event.stopPropagation()">üåê –°–∞–π—Ç</a>` : ""}
            </div>
          </div>
        </article>
      `;
    }


    function applyFilters(){
      const q = state.query.trim();
      const cat = state.selectedCategory;

      let list = state.places.filter(p => {
        const okCat = !cat || p.category === cat;
        const okQ = placeHasQuery(p, q);
        const okCity = (p.city || "").toLowerCase() === "khujand";
        return okCat && okQ && okCity;
      });

      if(state.sort === "rating"){
        list.sort((a,b)=> (b.rating||0) - (a.rating||0));
      } else if(state.sort === "near"){
        list.sort((a,b)=>{
          if(!state.userPos) return 0;
          const da = (Number.isFinite(a.geo.lat) && Number.isFinite(a.geo.lng))
            ? kmFromTo(state.userPos.lat, state.userPos.lng, a.geo.lat, a.geo.lng) : 1e9;
          const db = (Number.isFinite(b.geo.lat) && Number.isFinite(b.geo.lng))
            ? kmFromTo(state.userPos.lat, state.userPos.lng, b.geo.lat, b.geo.lng) : 1e9;
          return da - db;
        });
      } else {
        list.sort((a,b)=> (b.rating||0) - (a.rating||0));
      }

      return list;
    }

    function renderCategories(){
      const catsEl = $("cats");
      catsEl.innerHTML = "";

      const counts = state.places.reduce((acc,p)=>{
        acc[p.category] = (acc[p.category]||0) + 1;
        return acc;
      }, {});

      for(const c of state.categories){
        const isActive = state.selectedCategory === c.id;
        const icon = c.icon || "üìç";

        const el = document.createElement("button");
        el.type = "button";
        el.className = "cat" + (isActive ? " active" : "");
        el.innerHTML = `
          <div style="display:flex; align-items:center; gap:10px">
            <div class="badge">${esc(icon)}</div>
            <div>
              <div class="title">${esc(c.title)}</div>
              <div class="count">${(counts[c.id]||0)} –º–µ—Å—Ç</div>
            </div>
          </div>
          <div style="color:rgba(15,23,42,.45); font-weight:900">‚Ä∫</div>
        `;
        el.addEventListener("click", ()=>{
          state.selectedCategory = (state.selectedCategory === c.id) ? "" : c.id;
          $("catSelect").value = state.selectedCategory;
          renderAll();
        });

        catsEl.appendChild(el);
      }
    }

    function renderResults(){
      const results = applyFilters();
      $("status").textContent = `–ù–∞–π–¥–µ–Ω–æ: ${results.length}`;
      $("results").innerHTML = results.slice(0, 9).map(cardHTML).join("");
      $("empty").style.display = results.length ? "none" : "block";
    }

    function renderPopular(){
      const list = [...state.places]
        .filter(p => (p.city||"").toLowerCase() === "khujand")
        .sort((a,b)=> (b.rating||0) - (a.rating||0))
        .slice(0, 6);
      $("popular").innerHTML = list.map(cardHTML).join("") || `<div class="empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.</div>`;
    }

    function renderNear(){
      const nearHint = $("nearHint");
      if(!state.userPos){
        $("near").innerHTML = "";
        nearHint.style.display = "block";
        return;
      }
      nearHint.style.display = "none";

      const list = state.places
        .filter(p => (p.city||"").toLowerCase() === "khujand")
        .filter(p => Number.isFinite(p.geo.lat) && Number.isFinite(p.geo.lng))
        .map(p => ({ p, d: kmFromTo(state.userPos.lat, state.userPos.lng, p.geo.lat, p.geo.lng) }))
        .sort((a,b)=> a.d - b.d)
        .slice(0, 6)
        .map(x => x.p);

      $("near").innerHTML = list.map(cardHTML).join("") || `<div class="empty">–ü–æ–∫–∞ –Ω–µ—Ç –º–µ—Å—Ç —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏.</div>`;
    }

    function renderAll(){
      renderCategories();
      renderResults();
      renderPopular();
      renderNear();
    }

    async function loadJSON(url){
      const r = await fetch(url, { cache: "no-store" });
      if(!r.ok) throw new Error(`${url} -> ${r.status}`);
      return r.json();
    }

    async function init(){
      try{
        const [cats, places] = await Promise.all([
          loadJSON(CATEGORIES_URL),
          loadJSON(PLACES_URL)
        ]);

        state.categories = Array.isArray(cats) ? cats : [];
        state.places = (Array.isArray(places) ? places : []).map(normalizePlace);

        const sel = $("catSelect");
        sel.innerHTML = `<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>` + state.categories
          .map(c => `<option value="${esc(c.id)}">${esc(c.title)}</option>`)
          .join("");

        $("status").textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ –º–µ—Å—Ç: ${state.places.length}`;
        renderAll();
      } catch(err){
        console.error(err);
        $("status").textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JSON.";
      }
    }

    $("q").addEventListener("input", (e)=>{ state.query = e.target.value; renderResults(); });
    $("catSelect").addEventListener("change", (e)=>{ state.selectedCategory = e.target.value; renderAll(); });
    $("sort").addEventListener("change", (e)=>{ state.sort = e.target.value; renderResults(); renderNear(); });

    $("btnLocate").addEventListener("click", ()=>{
      if(!navigator.geolocation){
        $("geoStatus").textContent = "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è";
        return;
      }
      $("geoStatus").textContent = "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø‚Ä¶";
      navigator.geolocation.getCurrentPosition(
        (pos)=>{
          state.userPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          $("geoStatus").textContent = `–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: ${state.userPos.lat.toFixed(5)}, ${state.userPos.lng.toFixed(5)}`;
          renderNear();
          if(state.sort === "near") renderResults();
        },
        ()=>{ $("geoStatus").textContent = "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: –¥–æ—Å—Ç—É–ø –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω"; },
        { enableHighAccuracy: true, timeout: 8000, maximumAge: 60000 }
      );
    });

    init();
  </script>
</body>
</html>
